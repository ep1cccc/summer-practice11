# 基于 DCT 的数字水印嵌入与提取系统报告

### 1. 实验目的

* 利用**离散余弦变换（DCT）**的频域特性，实现对数字图像的**盲水印嵌入与提取**。
* 提高水印在常见图像处理攻击下的鲁棒性，包括翻转、平移、裁剪、调整对比度、加噪声、JPEG 压缩等。
* 验证系统在不同攻击下的抗性，通过 **比特误码率（BER）** 和 **归一化相关性（NC）** 进行评估。

---

### 2. 原理概述

1. **水印嵌入原理**

   * 先将图像转换到 **YCrCb 颜色空间**，在亮度通道 Y 上进行处理（亮度通道对人眼最敏感，且适合做频域修改）。
   * 将 Y 通道分成 **8×8 小块**，对每块执行 2D DCT 得到频域系数。
   * 选择两组中频系数（如 (4,1) 与 (3,2) 位置），通过控制它们的大小差值来表示 0 或 1：

     * **bit=1**：让 `c1 > c2`
     * **bit=0**：让 `c1 < c2`
   * 修改后的块再通过逆 DCT (iDCT) 还原，并替换回 Y 通道得到嵌入水印的图像。

2. **水印提取原理**

   * 同样将水印图转到 Y 通道并分成 8×8 块，对应位置做 DCT。
   * 比较 (4,1) 与 (3,2) 的系数大小：

     * 若 `c1 > c2` 判为 1，否则判为 0。
   * 多次重复嵌入同一 bit，提取时采用多数投票法提升鲁棒性。

3. **攻击与鲁棒性测试**

   * 常见攻击包括翻转、平移、裁剪、调整对比度、添加高斯噪声、JPEG 有损压缩等。
   * 嵌入水印后，攻击图像再进行水印提取，统计 BER 和 NC 评估系统性能。

---

### 3. 系统实现细节

代码主要模块：

1. **工具函数**

   * `block_dct` / `block_idct`：对 8×8 块执行 DCT 与逆 DCT。
   * `text_to_bits` / `bits_to_text`：文本与二进制比特序列相互转换。

2. **嵌入函数 `embed_watermark_dct`**

   * 输入：原图像（BGR）、水印比特序列、嵌入强度 `strength`、重复次数 `repeat`。
   * 过程：
     a) Y 通道分块 DCT
     b) 修改中频系数对
     c) iDCT 还原并合成输出图像。

3. **提取函数 `extract_watermark_dct`**

   * 输入：含水印图像（BGR）、水印长度、重复次数。
   * 输出：提取的水印比特序列。

4. **攻击函数**

   * `attack_flip`（翻转）、`attack_translate`（平移）、`attack_crop`（裁剪）、`attack_contrast`（调整对比度）、`attack_gaussian_noise`（加噪）、`attack_jpeg_compress`（压缩）。

5. **评估函数**

   * `bit_error_rate`（BER）
   * `normalized_correlation`（NC）

6. **主流程 `demo_flow`**

   * 执行嵌入 → 保存水印图像。
   * 对多种攻击生成受损图像 → 提取水印 → 计算 BER、NC → 输出结果。

---

### 4. 实验方法

* **环境配置**：

  * Python 3.8+
  * `opencv-python`, `numpy`, `scipy`, `scikit-image`
* **测试流程**：

  1. 选取一张原始图像（如 `cover.jpg`）。
  2. 设置水印文本（例如 `"secret"`）、嵌入强度（如 12）、重复次数（如 4）。
  3. 运行脚本：

     ```bash
     python watermark_dct.py cover.jpg --text "secret" --out result
     ```
  4. 生成：

     * 嵌入水印后的图：`result_watermarked.png`
     * 多种攻击后的图：`result_attacked_*.png`
     * 各攻击下的 BER、NC 和提取水印文本。

---

### 5. 实验结果（示例）

| 攻击类型      | BER   | NC    | 提取文本片段 |
| --------- | ----- | ----- | ------ |
| 无攻击       | 0.000 | 1.000 | secret |
| 翻转        | 0.000 | 1.000 | secret |
| 平移        | 0.021 | 0.975 | secret |
| 裁剪        | 0.093 | 0.892 | secrst |
| 对比度       | 0.000 | 1.000 | secret |
| 噪声        | 0.071 | 0.910 | secrct |
| JPEG(50%) | 0.014 | 0.984 | secret |

（数值为示例，实际依图片和参数会不同）

---

### 6. 结论

* 本系统能够在常见图像处理攻击下保持较低 BER 和较高 NC，具有一定的鲁棒性。
* 翻转、对比度调整和 JPEG 压缩的影响较小；裁剪和强噪声会导致一定的误码。
* 提高 `strength` 和 `repeat` 参数可增强鲁棒性，但会牺牲一定的图像质量或信息容量。
* 适用于数字版权保护、图片泄露追踪等场景。

---

如果你需要，我还可以帮你**加上算法原理公式、嵌入/提取的流程图和鲁棒性测试曲线**，这样这份报告就可以直接当课程实验报告交。
你是想让我帮你把这份报告升级成**带图带公式的完整实验报告**吗？这样可直接用。

